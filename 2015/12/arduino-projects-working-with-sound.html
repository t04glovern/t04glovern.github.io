<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>TwoFactor Assimilation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="http://t04glovern.github.io/js/jquery.min.js"></script>
  <script src="http://t04glovern.github.io/js/bootstrap.min.js"></script>
  <script src="http://t04glovern.github.io/js/header.js"></script>
  <script src="http://t04glovern.github.io/js/toc.js"></script>
  <link href="http://t04glovern.github.io/css/bootstrap.min.css" rel="stylesheet">
  <link href="http://t04glovern.github.io/css/theme.css" rel="stylesheet">
  <link href="http://t04glovern.github.io/css/syntax.css" rel="stylesheet">
  <link href="http://t04glovern.github.io/css/font-awesome/css/font-awesome.min.css" rel="stylesheet">
</head>

<body>

  
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-71336829-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


  


 <script type="text/javascript">
  WebFontConfig = {
    google: {
      families: ['Ubuntu::latin']
    }
  };
  (function() {
    var wf = document.createElement('script');
    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js';
    wf.type = 'text/javascript';
    wf.async = 'true';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(wf, s);
  })();
</script>

  <nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="http://t04glovern.github.io/">TwoFactor Assimilation</a>
      </div>
      <div class="collapse navbar-collapse">
        <ul class="nav navbar-nav">
          <li><a href="http://t04glovern.github.io/">/home</a></li>
          <li><a href="http://t04glovern.github.io/archive.html">/archive</a></li>
          <li><a href="http://t04glovern.github.io/tags.html">/tags</a></li>
          <li><a href="http://t04glovern.github.io/about.html">/about</a></li>
        </ul>
      </div>
    </div>
  </nav>


<div class="wrapper">
  <div class="content">
    <div class="container container-center">
      <div class="row">
        <div class="col-md-8">
          <div class="article">
            <div class="well">
              <h1><a href="http://t04glovern.github.io/2015/12/arduino-projects-working-with-sound">Arduino Projects - Working with Sound</a></h1>
              <div class="post-meta">
                <div class="post-time">
                  <i class="fa fa-calendar"></i>
                  <time>26 Dec 2015</time>
                </div>
                <ul>
                  
                    <li><a href="http://t04glovern.github.io/tag/arduino">arduino</a></li>
                  
                    <li><a href="http://t04glovern.github.io/tag/electronics">electronics</a></li>
                  
                    <li><a href="http://t04glovern.github.io/tag/sound">sound</a></li>
                  
                </ul>
              </div>
              <div class="post-content">
                <div id="toc" class="toc"></div>
                <h1 id="introduction">Introduction</h1>

<p>Tonight we’re going to be looking into how sound is produced and also run through the steps required to get our <code>Arduino</code> to produce sound. The <code>Arduino</code>can produce sounds a number of ways; The simplest method, and the one we’re going to look into is the <a href="https://www.arduino.cc/en/Reference/Tone"><code>tone()</code></a> function.</p>

<h1 id="understanding-how-a-speaker-works">Understanding how a speaker works</h1>

<p>Sound is transmitted through the air as a pressure wave. As an object such as a speaker, drum, or a bell vibrates, that object also vibrates the air around it. As the air particles vibrate, they transfer energy to the particles around them, vibrating these particles as well. This chain reaction creates a pressure wave that is transferred from the sound source to your eardrum.</p>

<p>When we create a sound with our Arduino we can control two properties of these vibrating particles; Frequency and Amplitude.</p>

<ol>
  <li><code>Frequency</code> - represents how quickly the air particles vibrate back and forth.
    <ul>
      <li>High Frequency = sounds are a higher pitch (soprano)</li>
      <li>Low Frequency = sounds are a lower pitch (bass)</li>
    </ul>
  </li>
  <li><code>Amplitude</code> - represents the magnitude of their vibrations.
    <ul>
      <li>High Amplitude = sounds are louder</li>
      <li>Low Amplitude = sounds are quieter</li>
    </ul>
  </li>
</ol>

<p>Example the waveforms below, specifically lets take a look at <code>Middle C</code></p>

<p><img src="http://t04glovern.github.io/images/posts/arduino-speaker-waves.jpg" alt="Speaker Waveform" /></p>

<p><code>Middle C</code> has a <code>frequency of 261.63 Hertz (Hz)</code>. In other words, a speaker, a guitar string, or a piano string would complete <code>261.63 oscillations per second</code>. We find the period of that by taking <code>1 / 261.62</code> which equals <code>3.822 milliseconds</code>, which is the width of one complete oscillation in the graph. We can use that value and set it as the period for a square wave and thus adjust the tone of a note.</p>

<p><code>NOTE:</code> Since the Arduino cannot create a true sinusoidal wave that you’d normally hear in the real world, we have to work with a plain square wave. The square wave oscillates between <code>HIGH</code> and <code>LOW</code> while switching instantly, instead of slowly like a sine wave. This results in a pressure wave that doesn’t fade off over time, leaving you with just a solid tone.</p>

<p><img src="http://t04glovern.github.io/images/posts/arduino-speaker-parts.png" alt="Speaker Parts" /></p>

<p>Looking at the speaker above, we can step through the process used to make a tone through a speaker.</p>

<ol>
  <li>
    <p>There’s a permanent magnet mounted behind the voice coil and pole piece</p>
  </li>
  <li>
    <p>We send a sinusoidal voltage signal (or a square wave in the case of the Arduino) into the leads of the coil</p>
  </li>
  <li>
    <p>The changing current induces a magnetic field that causes the voice coil and diaphragm to vibrate up and down as the permanent magnet is attracted to and then repulsed by the magnetic field that was generated.</p>
  </li>
  <li>
    <p>This back-and-forth vibration, in turn, vibrates the air in front of the speaker, effectively creating a sound wave that can travel to your eardrum.</p>
  </li>
</ol>

<h1 id="using-the-tone-function">Using the tone() function</h1>

<p><code>Arduino IDE</code> includes a built-in function for easily making sounds with arbitrary frequencies. The <a href="https://www.arduino.cc/en/Reference/Tone"><code>tone()</code></a> function generates a square wave of the selected frequency on the output pin of your choice. The tone() function accepts three arguments:</p>

<ol>
  <li>
    <p><code>pin</code> - the pin on which to generate the tone</p>
  </li>
  <li>
    <p><code>frequency</code> - the frequency of the tone in hertz (unsigned int)</p>
  </li>
  <li>
    <p><code>duration</code> - the duration of the tone in milliseconds (optional); If this argument is not set, the tone continues playing until you call <a href="https://www.arduino.cc/en/Reference/NoTone"><code>noTone()</code></a>.</p>
  </li>
</ol>

<p>Lets have a look at some code from the <a href="https://www.arduino.cc/en/Tutorial/ToneMelody?from=Tutorial.Tone">Arduino community reference page</a>.</p>

<p>To start with we hook up <code>positive</code> line from our <code>speaker</code> to <code>Digital Pin 8</code> on the <code>Arduino</code>. Lets add this line to our code defining the pin 8 constant:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// Pin for tone output</span>
<span class="kd">const</span> <span class="kt">int</span> <span class="n">tonePin</span> <span class="o">=</span> <span class="mi">8</span><span class="o">;</span></code></pre></figure>

<p>Next we’ll create a little melody for our Arduino to play. We can do this using an <code>array</code> called <code>melody</code> with our notes listed in each subsequent slot.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// Melody of notes</span>
<span class="kt">int</span> <span class="n">melody</span><span class="o">[]</span> <span class="o">=</span> <span class="o">{</span><span class="n">NOTE_C4</span><span class="o">,</span> <span class="n">NOTE_G3</span><span class="o">,</span> <span class="n">NOTE_G3</span><span class="o">,</span> <span class="n">NOTE_A3</span><span class="o">,</span> <span class="n">NOTE_G3</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">NOTE_B3</span><span class="o">,</span> <span class="n">NOTE_C4</span><span class="o">};</span></code></pre></figure>

<p>You’ll now notice that the notes we’ve referenced in the array don’t exist anywhere. Each of those note variables need to reference an <code>integer</code> value defining their <code>pitch</code>. You could go through and work these out yourself, but that would be silly; especially because there’s already a great list provided on the <a href="https://www.arduino.cc/en/Tutorial/ToneMelody?from=Tutorial.Tone">Tone Tutorial</a> page.</p>

<p>Go ahead and press <code>Ctrl+Shift+N</code> or select the <code>arrow</code> in the <code>right hand corner</code> of the Arduino IDE and click <code>New Tab</code>. Name the new file <code>pitches.h</code> and paste the following code into the IDE:</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="cp">#define NOTE_B0  31</span>
<span class="cp">#define NOTE_C1  33</span>
<span class="cp">#define NOTE_CS1 35</span>
<span class="cp">#define NOTE_D1  37</span>
<span class="cp">#define NOTE_DS1 39</span>
<span class="cp">#define NOTE_E1  41</span>
<span class="cp">#define NOTE_F1  44</span>
<span class="cp">#define NOTE_FS1 46</span>
<span class="cp">#define NOTE_G1  49</span>
<span class="cp">#define NOTE_GS1 52</span>
<span class="cp">#define NOTE_A1  55</span>
<span class="cp">#define NOTE_AS1 58</span>
<span class="cp">#define NOTE_B1  62</span>
<span class="cp">#define NOTE_C2  65</span>
<span class="cp">#define NOTE_CS2 69</span>
<span class="cp">#define NOTE_D2  73</span>
<span class="cp">#define NOTE_DS2 78</span>
<span class="cp">#define NOTE_E2  82</span>
<span class="cp">#define NOTE_F2  87</span>
<span class="cp">#define NOTE_FS2 93</span>
<span class="cp">#define NOTE_G2  98</span>
<span class="cp">#define NOTE_GS2 104</span>
<span class="cp">#define NOTE_A2  110</span>
<span class="cp">#define NOTE_AS2 117</span>
<span class="cp">#define NOTE_B2  123</span>
<span class="cp">#define NOTE_C3  131</span>
<span class="cp">#define NOTE_CS3 139</span>
<span class="cp">#define NOTE_D3  147</span>
<span class="cp">#define NOTE_DS3 156</span>
<span class="cp">#define NOTE_E3  165</span>
<span class="cp">#define NOTE_F3  175</span>
<span class="cp">#define NOTE_FS3 185</span>
<span class="cp">#define NOTE_G3  196</span>
<span class="cp">#define NOTE_GS3 208</span>
<span class="cp">#define NOTE_A3  220</span>
<span class="cp">#define NOTE_AS3 233</span>
<span class="cp">#define NOTE_B3  247</span>
<span class="cp">#define NOTE_C4  262</span>
<span class="cp">#define NOTE_CS4 277</span>
<span class="cp">#define NOTE_D4  294</span>
<span class="cp">#define NOTE_DS4 311</span>
<span class="cp">#define NOTE_E4  330</span>
<span class="cp">#define NOTE_F4  349</span>
<span class="cp">#define NOTE_FS4 370</span>
<span class="cp">#define NOTE_G4  392</span>
<span class="cp">#define NOTE_GS4 415</span>
<span class="cp">#define NOTE_A4  440</span>
<span class="cp">#define NOTE_AS4 466</span>
<span class="cp">#define NOTE_B4  494</span>
<span class="cp">#define NOTE_C5  523</span>
<span class="cp">#define NOTE_CS5 554</span>
<span class="cp">#define NOTE_D5  587</span>
<span class="cp">#define NOTE_DS5 622</span>
<span class="cp">#define NOTE_E5  659</span>
<span class="cp">#define NOTE_F5  698</span>
<span class="cp">#define NOTE_FS5 740</span>
<span class="cp">#define NOTE_G5  784</span>
<span class="cp">#define NOTE_GS5 831</span>
<span class="cp">#define NOTE_A5  880</span>
<span class="cp">#define NOTE_AS5 932</span>
<span class="cp">#define NOTE_B5  988</span>
<span class="cp">#define NOTE_C6  1047</span>
<span class="cp">#define NOTE_CS6 1109</span>
<span class="cp">#define NOTE_D6  1175</span>
<span class="cp">#define NOTE_DS6 1245</span>
<span class="cp">#define NOTE_E6  1319</span>
<span class="cp">#define NOTE_F6  1397</span>
<span class="cp">#define NOTE_FS6 1480</span>
<span class="cp">#define NOTE_G6  1568</span>
<span class="cp">#define NOTE_GS6 1661</span>
<span class="cp">#define NOTE_A6  1760</span>
<span class="cp">#define NOTE_AS6 1865</span>
<span class="cp">#define NOTE_B6  1976</span>
<span class="cp">#define NOTE_C7  2093</span>
<span class="cp">#define NOTE_CS7 2217</span>
<span class="cp">#define NOTE_D7  2349</span>
<span class="cp">#define NOTE_DS7 2489</span>
<span class="cp">#define NOTE_E7  2637</span>
<span class="cp">#define NOTE_F7  2794</span>
<span class="cp">#define NOTE_FS7 2960</span>
<span class="cp">#define NOTE_G7  3136</span>
<span class="cp">#define NOTE_GS7 3322</span>
<span class="cp">#define NOTE_A7  3520</span>
<span class="cp">#define NOTE_AS7 3729</span>
<span class="cp">#define NOTE_B7  3951</span>
<span class="cp">#define NOTE_C8  4186</span>
<span class="cp">#define NOTE_CS8 4435</span>
<span class="cp">#define NOTE_D8  4699</span>
<span class="cp">#define NOTE_DS8 4978</span></code></pre></figure>

<p>Save that file and navigate back to your tone project we were working on before.</p>

<p>Next we’ll define the tones duration, and again we’ll use a matching <code>array of integers</code></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="c1">// note durations: 4 = quarter note, 8 = eighth note, etc.:</span>
<span class="kt">int</span> <span class="n">noteDurations</span><span class="o">[]</span> <span class="o">=</span> <span class="o">{</span><span class="mi">4</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">};</span></code></pre></figure>

<p>Now that we have a tune setup and defined we can move into the <code>setup()</code> block and begin writing the code that will play our tones.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span>
  <span class="c1">// iterate over the notes of the melody:</span>
  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">thisNote</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">thisNote</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="o">;</span> <span class="n">thisNote</span><span class="o">++)</span> <span class="o">{</span>

    <span class="c1">// to calculate the note duration, take one second</span>
    <span class="c1">// divided by the note type.</span>
    <span class="c1">//e.g. quarter note = 1000 / 4, eighth note = 1000/8, etc.</span>
    <span class="kt">int</span> <span class="n">noteDuration</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">noteDurations</span><span class="o">[</span><span class="n">thisNote</span><span class="o">];</span>
    <span class="n">tone</span><span class="o">(</span><span class="n">tonePin</span><span class="o">,</span> <span class="n">melody</span><span class="o">[</span><span class="n">thisNote</span><span class="o">],</span> <span class="n">noteDuration</span><span class="o">);</span>

    <span class="c1">// to distinguish the notes, set a minimum time between them.</span>
    <span class="c1">// the note&#39;s duration + 30% seems to work well:</span>
    <span class="kt">int</span> <span class="n">pauseBetweenNotes</span> <span class="o">=</span> <span class="n">noteDuration</span> <span class="o">*</span> <span class="mf">1.30</span><span class="o">;</span>
    <span class="n">delay</span><span class="o">(</span><span class="n">pauseBetweenNotes</span><span class="o">);</span>
    <span class="c1">// stop the tone playing:</span>
    <span class="n">noTone</span><span class="o">(</span><span class="n">tonePin</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="o">()</span> <span class="o">{</span>
  <span class="c1">// no need to repeat the melody.</span>
<span class="o">}</span></code></pre></figure>

<p>Run your code and enjoy the jams! Note that since we haven’t setup this code to <code>loop</code>; you’ll need to either reboot your <code>Arduino</code> or press the <code>reset button</code> on the board to get the tone to replay. You could even move the code block in <code>setup()</code> down into <code>loop()</code> to get it to continuously play the tones.</p>

<h1 id="conclusion">Conclusion</h1>

<p>I wish I had more to say on this topic, It turned out to be a lot easier than I expected. I hope to expand on some ideas with the speaker in some later projects; but for now it was great to just learn the fundamental details about how a speaker actually works. I hope it was helpful for you as well :)</p>

<p>Thanks to resources taken from <a href="http://exploringarduino.com/">Jeremy Blum’s - Exploring Arduino</a> and may great tutorials on the <a href="https://www.arduino.cc">arduino.cc</a> webpage.</p>

              </div>
              
            </div>
          </div>
        </div>
        <div class="col-md-4 hidden-xs">
          <div class="sidebar ">
  <h1>Recent Posts</h1>
  <ul>
    
    <li><a href="/2015/12/arduino-projects-working-with-sound">Arduino Projects - Working with Sound</a></li>
    
    <li><a href="/2015/12/arduino-project-lcd-displays">Arduino Projects - LCD Displays</a></li>
    
    <li><a href="/2015/12/arduino-projects-thumbstick-to-rgb-led">Arduino Projects - Thumbstick to RGB LED</a></li>
    
    <li><a href="/2015/12/learning-aspnet-building-in-visual-studio-2015-part-3">Learning ASP.NET - Building in Visual Studio 2015 (Part 3)</a></li>
    
    <li><a href="/2015/12/learning-aspnet-using-vscode-and-yeoman-part-2">Learning ASP.NET - Using VScode and Yeoman (Part 2)</a></li>
    
  </ul>
</div>

<div class="sidebar">
  <h1>Tags</h1>
  <ul>
    
      <li><a href="/tag/node.js">node.js</a></li>
    
      <li><a href="/tag/bash">bash</a></li>
    
      <li><a href="/tag/script">script</a></li>
    
      <li><a href="/tag/asp.net">asp.net</a></li>
    
      <li><a href="/tag/windows">windows</a></li>
    
      <li><a href="/tag/yeoman">yeoman</a></li>
    
      <li><a href="/tag/vscode">vscode</a></li>
    
      <li><a href="/tag/visualstudio">visualstudio</a></li>
    
      <li><a href="/tag/arduino">arduino</a></li>
    
      <li><a href="/tag/electronics">electronics</a></li>
    
      <li><a href="/tag/lcd">lcd</a></li>
    
      <li><a href="/tag/sound">sound</a></li>
    
  </ul>
</div>

        </div>
      </div>
    </div>
    

  </div>
      <footer class="footer-distributed">
      <div class="container">
        <div class="footer">
          <p>Nathan Glover &copy; 2015</p>
          <h6>Follow me</h6>

<ul class="social-media">

  
    <li>
      <a title="t04glovern on Github" href="https://github.com/t04glovern" target="_blank"><i class="fa fa-github fa-2x"></i></a>
    </li>
  

  
    <li>
      <a title="5443325 on StackOverflow" href="http://stackoverflow.com/users/5443325" target="_blank"><i class="fa fa-stack-overflow fa-2x"></i></a>
    </li>
  

  
    <li>
      <a title="t04glovern on LinkedIn" href="https://www.linkedin.com/in/glovernathan" target="_blank"><i class="fa fa-linkedin fa-2x"></i></a>
    </li>
  

  

  

  
    <li>
      <a title="feed.xml RSS" href="http://t04glovern.github.io/feed.xml" target="_blank"><i class="fa fa-rss fa-2x"></i></a>
    </li>
  

</ul>

        </div>
      </div>
    </footer>
  </body>
</html>

</div>
